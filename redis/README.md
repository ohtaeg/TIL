# 레디스
- `Re`mote `Di`ctionary `S`erver
- Dictionary 의미는 해시맵과 같이 키-밸류 형태로 상수의 시간 복잡도로 사용 가능한 C로 작성된 오픈소스 인메모리 데이터 저장소

## 특징
- 인메모리 데이터 저장소라는 말은 백업과 스냅샷을 제외한 모든 데이터를 램에 저장
  - 램은 디스크에 비해 매우 빠르기 때문에 RDB와 다른 구조와 특징을 갖는다.
- 싱글 스레드로 데이터를 처리한다.
- 레디스는 클러스모드를 지원한다.
  - 다중 노드에 데이터를 분산 저장하여 안정성과 고가용성을 제공
- 영속성 제공
  - 레디스는 인메모리 데이터베이스라는 특성상 주로 휘발성 데이터를 저장하지만  
  - RDB(Redis Database) + AOF(Append only file)라는 2개의 옵션을 통해 영속성 제공할 수 있다.
- Pub / Sub

<br>

## 장점
- 높은 성능, 메모리에 저장하기 때문에 빠른 읽기와 쓰기
- 다양한 데이터 타입 지원
- 다양한 언어로 작성된 클라이언트 라이브리러 지원하여 쉽게 연동
- 많은 생태계 및 레퍼런스

<br>

## 왜 레디스는 싱글 스레드인가?
- 멀티스레드로 디비 엔진을 구성했을 떄의 장점이 있지만 그만큼 복잡도가 높아지기 때문에 레디스 진영은 싱글 스레드 채택
- 실제 유저 레벨에서는 싱글 스레드로 동작하지만 명령에 대한 처리는 커널 I/O 레벨에서 Multiplexing(멀티플렉싱)을 통해 처리
- 레디스의 병목현상의 대부분은 CPU가 아닌 시스템 메모리/네트워크 대역폭에서 발생

<br>

## 레디스 사용 사례
- 캐싱으로 많은 활용
  - 임시 비밀번호
  - 로그인 세션
- `Rate Limiter`
  - 서버에서 특정 API에 대한 요청 횟수를 제한하기 위해 사용하는 기술로 Redis로 쉽게 구현 가능
- 메시지 브로커
  - 리스트나 스트림지 같은 데이터 타입을 활용하여 메시지 브로커로써 활용 가능
- 실시간 분석과 계산
  - 스코어에 따라 순위를 표시하는 순위표
  - 좌표를 이용한 반경 탐색
  - 실시간 방문자 수 계산
- 레디스 Pub/Sub 패턴을 활용하여 실시간 채팅 구현

<br>

## 캐싱 사용 사례
- 공학적으로 다양한 곳에 사용된다.
- 대표적으로 CPU 캐시가 존재하는데 CPU와 RAM의 속도 차이로 인해 (CPU 속도에 비해 RAM이 느리기 때문에) CPU는 자원을 활용하지 못하고 기다리는 상황이 발생
  - 이때 L1, L2, L3 라는 캐시가 CPU와 램의 속도 차이에서 발생하는 지연을 보완
- 웹 브라우저 캐싱도 있다. 웹 브라우저가 웹 페이지 데이터를 로컬 저장소에 저장하여 페이지 재방문시 새로 읽지 않고 캐싱하여 재사용
- DNS 캐싱, 도메인과 IP 연결이 자주 바뀌지 않기 때문에 해당 데이터를 캐싱해두고 빠르게 응답
- 데이터베이스 캐싱, MySQL 과 같은 DB는 버퍼풀이라는 곳에 자주 사용되는 데이터를 메모리에 미리 올려둔다.
- CDN, 이미지, 동영상 등의 큰 파일들을 요청했을 때 요청자와 파일 서버의 거리가 멀다면 파일 전송에 많은 시간이 소요되기 때문에 CDN을 통해 POP 서버라는 곳에 미리 파일들을 옮겨놓고 요청자와 가장 가까운 POP 서버에서 파일을 응답
- 어플리케이션 캐싱, 레디스 등을 이용하여 데이터 등의 데이터를 캐싱하여 반복작업 최적화

<br>


## Persistence
- 레디스는 주로 캐시로 사용되기 때문에 기본적으로 손실되어도 무방한 테이터를 기록하지만 <br>
실제 운영하다보면 캐시라 할지라도 데이터 손실이 발생하면 서비스가 지연되거나 장애로 이어질 수 있다. 
- 데이터 손실 방지를 위한 영속성 옵션을 제공한다.
- `RDB` (Redis Databse)
  - 특정 시간에 스냅샷을 생성하는 옵션
  - 장애가 발생했을 때 특정 시점에 스냅샷으로 캐시를 되돌리거나 (장애 복구)
  - 동일한 데이터를 가진 캐시를 복제할때 사용
  - 다만 스냅샷의 특성상 새로운 스냅샷이 생성되기전에 일부 데이터의 유실이 있을 수 있고 
  - 스냅샷 생성은 레디스의 성능 저하를 발생하여 클라이언트 요청 처리가 지연될 수 있다.
- `AOF` (Append Only File)
  - 모든 write 작업을 로그로 저장하는 옵션
  - 데이터 유실의 위험은 적지만, 장애 복구시 로그에 있는 데이터를 모두 다시 적용해야되기 때문에 스냅샷보다 느리다.
- 두 옵션을 각각 사용하거나, 둘다 사용하지 않거나 하나만 사용하거나 할 수 있다.

<br>

## Cache - Aside Pattern
- 어플리케이션에서 클라이언트 요청을 처리할 때 먼저 캐시를 조회
- 캐시 히트면 그대로 사용, 미스인 경우 스토리지에서 조회하여 데이터 캐싱하는 흔한 패턴
- 그 외에 write-through, write-behind 같은 패턴도 있지만 자주 사용하지 않음